<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>More on scraping - Data reporting @ Cronkite</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>More on scraping | Data reporting @ Cronkite</title> <meta name="generator" content="Jekyll v3.7.4" /> <meta property="og:title" content="More on scraping" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A collection of materials used in the data reporting class at ASU’s Cronkite School of Journalism" /> <meta property="og:description" content="A collection of materials used in the data reporting class at ASU’s Cronkite School of Journalism" /> <link rel="canonical" href="http://localhost:4000/assets/docs/xpath.html" /> <meta property="og:url" content="http://localhost:4000/assets/docs/xpath.html" /> <meta property="og:site_name" content="Data reporting @ Cronkite" /> <script type="application/ld+json"> {"url":"http://localhost:4000/assets/docs/xpath.html","headline":"More on scraping","description":"A collection of materials used in the data reporting class at ASU’s Cronkite School of Journalism","@type":"WebPage","@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Data reporting @ Cronkite</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a></li><li class="navigation-list-item"><a href="http://localhost:4000/general" class="navigation-list-link">General topics</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/general/01-resources.html" class="navigation-list-link">Resources</a></li><li class="navigation-list-item "><a href="http://localhost:4000/general/02-sourcing.html" class="navigation-list-link">Data sources and sourcing</a></li><li class="navigation-list-item "><a href="http://localhost:4000/general/03-newsroom-math.html" class="navigation-list-link">Newsroom math</a></li><li class="navigation-list-item "><a href="http://localhost:4000/general/05-file-formats.html" class="navigation-list-link">File formats</a></li><li class="navigation-list-item "><a href="http://localhost:4000/general/06-programming-concepts.html" class="navigation-list-link">Intro to coding</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/excel" class="navigation-list-link">Excel</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/excel/xlguides" class="navigation-list-link">Excel guides</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="http://localhost:4000/excel/xlguides/xl-refresher.html" class="navigation-list-link">Excel refresher</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/xlguides/xl-tidydata.html" class="navigation-list-link">Data types / tidy data</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/xlguides/xl-pivot.html" class="navigation-list-link">Grouping with pivot tables</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/xlguides/xl-filtersort.html" class="navigation-list-link">Filter and sort</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/xlguides/xl-formulas.html" class="navigation-list-link">Excel formulas</a> </li></ul></li><li class="navigation-list-item "><a href="http://localhost:4000/excel/xlpractice" class="navigation-list-link">Excel practice</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/01-excel-azpop-exercise.html" class="navigation-list-link">Change and percent in Arizona population data</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/03-excel-rates.html" class="navigation-list-link">Rates and ratios with FBI data</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/05-excel-police-uof.html" class="navigation-list-link">Build your own use of force database</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/07-excel-kpop.html" class="navigation-list-link">Formulas for boring Spotify playlists</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/08-excel-pop-filter-sort.html" class="navigation-list-link">Population data filter & sort</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/11-excel-pivot-pools.html" class="navigation-list-link">Practice with swimming pool inspections</a> </li><li class="navigation-list-item "> <a href="http://localhost:4000/excel/practice/12-excel-baseball.html" class="navigation-list-link">Pivot tables with baseball scores</a> </li></ul></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/r-stats" class="navigation-list-link">R for journalism</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/r-stats/r-intro.html" class="navigation-list-link">Starting R</a></li><li class="navigation-list-item "><a href="http://localhost:4000/r-stats/r-test-embed.html" class="navigation-list-link">Starting R</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/special" class="navigation-list-link">Special</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/special/scrape-part1.html" class="navigation-list-link">Scraping part 1</a></li><li class="navigation-list-item "><a href="http://localhost:4000/special/cleanup_pdf.html" class="navigation-list-link">PDF tools</a></li><li class="navigation-list-item "><a href="http://localhost:4000/special/cleanup_openrefine.html" class="navigation-list-link">Cleaning data with OpenRefine</a></li><li class="navigation-list-item "><a href="http://localhost:4000/special/regex-beginning.html" class="navigation-list-link">Intro to Regular Expressions</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/records" class="navigation-list-link">Public records</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/foia/foia-help.html" class="navigation-list-link">Getting FOIA help</a></li><li class="navigation-list-item "><a href="http://localhost:4000/foia/records-stories.html" class="navigation-list-link">FOIA stories</a></li><li class="navigation-list-item "><a href="http://localhost:4000/foia/public-records-outside-in.html" class="navigation-list-link">Public records strategy</a></li><li class="navigation-list-item "><a href="http://localhost:4000/foia/arizona-foia.html" class="navigation-list-link">Arizona public records</a></li><li class="navigation-list-item "><a href="http://localhost:4000/foia/tips.html" class="navigation-list-link">FOIA resources</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/workshops" class="navigation-list-link">Workshops</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/workshops/bootcamp.html" class="navigation-list-link">Cronkite bootcamp</a></li><li class="navigation-list-item "><a href="http://localhost:4000/workshops/cronkite-mayo.html" class="navigation-list-link">Cronkite-Mayo</a></li><li class="navigation-list-item "><a href="http://localhost:4000/workshops/newstrain/newstrain.html" class="navigation-list-link">NewsTrain Phoenix</a></li><li class="navigation-list-item "><a href="http://localhost:4000/workshops/writing.html" class="navigation-list-link">NICAR master class</a></li><li class="navigation-list-item "><a href="http://localhost:4000/workshops/phd-sources.html" class="navigation-list-link">Links to source data for doctoral students</a></li><li class="navigation-list-item "><a href="http://localhost:4000/workshops/fundamental1day.html" class="navigation-list-link">1-day CAR workshop</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Data reporting @ Cronkite" aria-label="Search Data reporting @ Cronkite" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="https://isearch.asu.edu/profile/3189494">Sarah Cohen / Knight Chair / Cronkite School</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 id="more-on-scraping"> <a href="#more-on-scraping" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> More on scraping </h1> <h2 id="more-tools"> <a href="#more-tools" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> more tools </h2> <ul> <li>Outwit hub (now about $50, but powerful)</li> <li>import.io - said to be the easiest out there, but I’ve had trouble using it.</li> </ul> <p>By the time I get through trying to learn a tool, I might as well have learned to program it. Key parts of Python that will help with difficult sites:</p> <ul> <li>Scrapy - a whole library of scraping tools that has its own manual and syntax. I think this one uses XPath though, so it will be easier to incorporate that in.</li> <li>Selenium, for when you need to actually run a browser. *</li> </ul> <p>Building on the tutorial that is at the http://sarahcnyt.github.io/ire-toronto site</p> <p>These examples came up recently and I needed to memorialize it for myself. It’s just to help me remember.</p> <p>Start with Chrome inspection tool, right click on the element you want, then copy the XPath to give you a start.</p> <h2 id="finding-text-between-tags"> <a href="#finding-text-between-tags" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Finding Text Between Tags </h2> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;td nowrap=""&gt;
	&lt;font face="arial" size="2"&gt;
		&lt;b&gt;ABRAMSON, JOEL ELIOT &amp;nbsp; &amp;nbsp; &lt;br&gt; &lt;/b&gt;
		JOEL E. ABRAMSON, P.C. &amp;nbsp; &amp;nbsp; &lt;br&gt;
		271 MADISON AVE FL 22 &amp;nbsp; &amp;nbsp; &lt;br&gt;
		NEW YORK, NY 10016 &amp;nbsp; &amp;nbsp; &lt;br&gt;
		(212)599-7700 &amp;nbsp; &amp;nbsp;
	&lt;/font&gt;
&lt;/td&gt;
</code></pre></div></div> <p>If the whole chunk is the 2nd column, it’s [2]</p> <p>How can I get the name, which is outlined by the &lt; b &gt; (bold) tag? That text is the first text() element below the “font” tag, Any of these will work:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [2]/font/text()
	or
 [2]//text()
	or
 [2]/font/b/text()
</code></pre></div></div> <p>A little less intuitively:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> *[2]font[1]/child::text()
	or
 *[2]/node()/node()
	or
 *[2]/font/node()[position=1]
</code></pre></div></div> <p>The bold tag is the first child of the font tag. Technically, the “node” is everything between the font tags, then the second node is everything between the bold tags.</p> <p>Here’s how to get the city, state, zipcode from that chunk. (Use the last-1 because some firms had two-line addresses and others had only one. It would fail in cases where the city, state was the last row.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	*[2]/font/text()[position()=last()-1]
			or
	*[2]//text()[count(following-sibling::br)=1]
</code></pre></div></div> <p>What if you had a slightly different piece of code, this one a line from the <a href="http://www.seminoles.com/SportSelect.dbml?SPID=157113&amp;SPSID=917030">Florida State football roster</a></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;tr class="odd"&gt;
	&lt;td class="number"&gt;3&lt;/td&gt;
	&lt;td class="name"&gt;
		&lt;span class="sortname" style="display:none;"&gt;Darby Ronald&lt;/span&gt;
		&lt;a title="Ronald Darby" href="/ViewArticle.dbml?ATCLID=209573037&amp;amp;DB_OEM_ID=32900"&gt;Ronald Darby&lt;/a&gt;
	&lt;/td&gt;
	&lt;td class="position"&gt;CB&lt;/td&gt;
	&lt;td class="height" nowrap=""&gt;5-11&lt;/td&gt;
	&lt;td class="weight"&gt;195&lt;/td&gt;
	&lt;td class="year"&gt;
		&lt;span style="display:none;"&gt;3&lt;/span&gt;
		Jr.
	&lt;/td&gt;
	&lt;td class="hometown "&gt;Oxon Hill, Md. / Potomac&lt;/td&gt;
&lt;/tr&gt;
</code></pre></div></div> <p>I’ll come back to this example later, so it’s worth having the whole snippet here. But all I care about right now is to pick up the “Jr” separate from the “3” in the class year.</p> <p>The first part is obvious, assuming we’re starting from the row.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  *[6]/span
	 or
  *[@class="year"]/span
</code></pre></div></div> <p>How about getting just the word, without the number?</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  *[6]/node()[position()=3]
</code></pre></div></div> <p>or position()=last would work. It’s the 3rd node, not the second, because there is a span element in between. If it were text(), it would be the second.</p> <p>Recap:</p> <ul> <li>To get everything as text, without the tags in between, just use the position or name.</li> <li>To get the first text element, use <strong>text()</strong> or <strong>text()[position()=1]</strong>. It’s the same thing.</li> <li>To get the last text element, use <strong>text()[position()=last]</strong></li> <li>To get a list of all of the elements, which has an entry for each tag and another for its text representation, use <strong>node()</strong> instead of <strong>text()</strong>. If for some reason you only want the list of tags without what they contain, use <strong>element()</strong></li> </ul> <h2 id="finding-elements"> <a href="#finding-elements" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Finding elements </h2> <p>Key XPath selectors are:</p> <ul> <li> <p><strong>descendant-or-self</strong>, which refers to everything below as well as yourself. It helps when you don’t know what level it might be. For example, in the html above, finding the “sortname” class wouldn’t depend on you knowing that it was two levels below.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  descendant-or-self::node()[@class="sortname"]
</code></pre></div> </div> </li> <li> <p><strong>count(preceding-sibling::p)</strong> would count how many &lt; p &gt; tags came before. The opposite is <strong>following-sibling::tag</strong>. Leave off the the tag if you want just the number of elements, but they will be at the same level. You can use the count as a test, so that if you want the first two paragraphs, it can be: * text()[count(preceding-sibling::p)&lt;3]</p> </li> <li> <p><strong>attributes of a tag, like onclick() action</strong> This was an interesting one, from the NYC ACRIS real estate document database. In this case, we were looking in an exercise for a company called Prevezon. There were about 30 records, just enough to make clicking into them a pain. If you get fewer than 100 records, you can scrape all using Chrome scraper. The key, though, is the link to the detail page. That is under the input button as an onclick event. Here is how I made the XPATH to get to that.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  substring(*[1]/div/font/input[1]/@onclick, 23,16))
</code></pre></div> </div> <p>This says, for each of the 1st tds, look for div/font/input[1] – he first input item (there are two). Then find the @click attribute, and take the 16 characters beginning at 23. To create the actual link, you can use concat(“root html”, your substring)</p> </li> </ul> </div> </div> </div> </div> </body> </html>
